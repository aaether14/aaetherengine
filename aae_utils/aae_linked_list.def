/**
---aae_linked_list.def - Dinescu Stefan-Cristian aka Aaether - 31.07.2016
----------------------------------------------------------------------
Code generation for linked list holding TYPE data
-td stands for typedef
-don't ever use variables, functions etc. starting with "__". Only the framework has this right.
Features:
-push a new node to the front of the list
-push a new node to the back of the list
Safe types:
-aae_LinkedList(TYPE)
-aae_LinkedListElement(TYPE)
*/



#ifndef AAE_LINKED_LIST_DEF
#define AAE_LINKED_LIST_DEF
#include "aae_defines.h"
#include "aae_types.h"
#include <malloc.h>



/**
*Posible return values for the linked list
*/
typedef enum
	{	AAE_LINKED_LIST_ALLOCATION_ERROR = -2, //malloc error
		AAE_LINKED_LIST_INVALID_LIST = -1, //invalid list pointer
		AAE_LINKED_LIST_FALSE = 0,
		AAE_LINKED_LIST_TRUE = 1,
		AAE_LINKED_LIST_SUCCESS = 2
	} AAE_LINKED_LIST_RETURN_VALUES;
#endif /* AAE_LINKED_LIST_H*/






#ifndef AAE_LINKED_LIST_TYPE
#error "Must define AAE_LINKED_LIST_TYPE!"
#endif



/**
*Indirection is used in order to achieve defined token concatenation
*/
#define __AAE_LINKED_LIST_PREFIX(NAME) INDIRECT_TOKENPASTE(INDIRECT_TOKENPASTE(__linked_list, NAME), AAE_LINKED_LIST_TYPE)



	struct __AAE_LINKED_LIST_PREFIX(_elem) /* __linked_list_elem##AAE_LINKED_LIST_TYPE -eg.__linked_list_elemfloat */
	{
		AAE_LINKED_LIST_TYPE m_data;
		__AAE_LINKED_LIST_PREFIX(_elem) * m_next;
	};


	struct __AAE_LINKED_LIST_PREFIX(_) /* __linked_list_##AAE_LINKED_LIST_TYPE -eg. __linked_list_float */
	{
		//member data
		aae_size_t m_size;
		__AAE_LINKED_LIST_PREFIX(_elem) * m_first;
		__AAE_LINKED_LIST_PREFIX(_elem) * m_last;
		__AAE_LINKED_LIST_PREFIX(_elem) * m_it;

		//member functions
		AAE_LINKED_LIST_RETURN_VALUES push_back(AAE_LINKED_LIST_TYPE tValue);
		AAE_LINKED_LIST_RETURN_VALUES push_front(AAE_LINKED_LIST_TYPE tValue);


	};


	AAE_LINKED_LIST_RETURN_VALUES __AAE_LINKED_LIST_PREFIX(_)::push_back(AAE_LINKED_LIST_TYPE tValue)
	{

		__AAE_LINKED_LIST_PREFIX(_elem) * pNewElem = (__AAE_LINKED_LIST_PREFIX(_elem)*)malloc(sizeof(__AAE_LINKED_LIST_PREFIX(_elem)));
		if (!pNewElem) return AAE_LINKED_LIST_ALLOCATION_ERROR;


		pNewElem->m_next = NULL; pNewElem->m_data = tValue;
		if (!this->m_first) this->m_first = this->m_last = pNewElem;
		else { this->m_last->m_next = pNewElem; this->m_last = pNewElem; }


		this->m_size++;
		return AAE_LINKED_LIST_SUCCESS;
	}



	AAE_LINKED_LIST_RETURN_VALUES __AAE_LINKED_LIST_PREFIX(_)::push_front(AAE_LINKED_LIST_TYPE tValue)
	{

		__AAE_LINKED_LIST_PREFIX(_elem) * pNewElem = (__AAE_LINKED_LIST_PREFIX(_elem)*)malloc(sizeof(__AAE_LINKED_LIST_PREFIX(_elem)));
		if (!pNewElem) return AAE_LINKED_LIST_SUCCESS;


		pNewElem->m_next = NULL; pNewElem->m_data = tValue;
		if (!this->m_first) this->m_first = this->m_last = pNewElem;
		else { pNewElem->m_next = this->m_first; this->m_first = pNewElem; }


		this->m_size++;
		return AAE_LINKED_LIST_SUCCESS;

	}




	__AAE_LINKED_LIST_PREFIX(_) * __AAE_LINKED_LIST_PREFIX(_new_list)()
	{

		__AAE_LINKED_LIST_PREFIX(_) * pNewList = (__AAE_LINKED_LIST_PREFIX(_)*)malloc(sizeof(__AAE_LINKED_LIST_PREFIX(_)));
		pNewList->m_first = pNewList->m_last = pNewList->m_it = NULL;
		pNewList->m_size = 0;
		return pNewList;

	}



	void __AAE_LINKED_LIST_PREFIX(_free_nodes)(__AAE_LINKED_LIST_PREFIX(_) * pList)
	{

		if (!pList) return;
		pList->m_it = pList->m_first;
		__AAE_LINKED_LIST_PREFIX(_elem) * pTempElem = NULL;

		while (pList->m_it != NULL)
		{

			pTempElem = pList->m_it;
			pList->m_it = pList->m_it->m_next;
			free(pTempElem);

		}

		pList->m_first = pList->m_last = pList->m_it = NULL;

	}




/**
*Types
*/
#define aae_LinkedList(TYPE)					__linked_list_##TYPE //Defines a linked list of a certain TYPE
#define aae_LinkedListElement(TYPE)				__linked_list_elem_##TYPE //Defines a node holding data of TYPE
/**
List members (better don't modify this using other than defined functions):
m_first - the first node in the list
m_last - the last node in the list
m_size - the size of the list
*/



/**
*Functions
*/
#define aae_LinkedListFreePopFront(TYPE, list)			free(__linked_list_pop_front##TYPE(list)) /* free poped element */
#define aae_LinkedListNewList(TYPE)				__linked_list_new_list##TYPE()
#define aae_LinkedListFreeNodes(TYPE, list)			__linked_list_free_nodes##TYPE(list)
#define aae_LinkedListForEach(list)				for (list->m_it = list->m_first; list->m_it != NULL; list->m_it = list->m_it->m_next)



#ifdef AAE_LINKED_LIST_TYPE
#undef AAE_LINKED_LIST_TYPE
#endif
